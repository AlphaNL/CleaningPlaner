<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clean Planner ‚Äî Snake Game</title>
<link rel="stylesheet" href="styles.css">
<style>
/* –°—Ç–∏–ª—å –±–∞–Ω–µ—Ä–∞ */
.banner {
  position: relative;
  cursor: pointer;
}
.banner img {
  width: 100%;
  border-radius: 12px;
  display: block;
}

/* –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –∑–º—ñ–π–∫–∏ */
.snake-full {
  padding:0; width:100vw; max-width:none; height:100vh; max-height:none;
  border-radius:0; margin:0;
  background:linear-gradient(135deg,#0b1220,#111827);
  color:#e5e7eb;
}
.snake-full::backdrop{ background:rgba(0,0,0,.6) }

.snake-topbar {
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding: max(14px, env(safe-area-inset-top)) 16px 10px 16px;
}
.snake-scores{display:flex; gap:12px; font-weight:700}
.snake-actions{display:flex; gap:8px}

.snake-wrap {
  display:grid; place-items:center;
  height: calc(100vh - 140px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  padding: 0 12px;
}

#snakeCanvas {
  width: min(92vw, 92vh); height: auto;
  background:#0b1220; border-radius:16px; display:block;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);
  touch-action:none; user-select:none; -webkit-user-select:none;
}

.game-hint {
  text-align:center; color:#94a3b8; font-size:12px; padding:10px 16px 16px
}
</style>
</head>
<body>

<main class="card">
  <h2>–ì—Ä–∞ "–ó–º—ñ–π–∫–∞"</h2>
  <div class="banner" id="openSnake">
    <img src="https://raw.githubusercontent.com/AlphaNL/CleaningPlaner/5d9c580ae8f440fa242188981eec72cc2a536806/FC0A03B0-579F-4F9D-8C47-801A1D3D0698.png" alt="Snake Banner">
  </div>
</main>

<dialog class="snake-full" id="snakeDialog">
  <div class="snake-topbar">
    <div class="snake-scores">
      <span id="scoreLbl">–û—á–∫–∏: 0</span>
      <span id="bestLbl">–†–µ–∫–æ—Ä–¥: 0</span>
    </div>
    <div class="snake-actions">
      <button id="btnPause">‚è∏</button>
      <button id="btnRestart">üîÑ</button>
      <button id="btnCloseSnake">‚ùå</button>
    </div>
  </div>
  <div class="snake-wrap">
    <canvas id="snakeCanvas" width="320" height="320"></canvas>
  </div>
  <div class="game-hint">–ö–µ—Ä—É–π —Å—Ç—Ä—ñ–ª–∫–∞–º–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è–º –Ω–∞ –µ–∫—Ä–∞–Ω</div>
</dialog>

<script>
const snakeDialog = document.getElementById('snakeDialog');
const openSnakeBtn = document.getElementById('openSnake');
const can = document.getElementById('snakeCanvas');
const ctx = can.getContext('2d');
const scoreLbl = document.getElementById('scoreLbl');
const bestLbl  = document.getElementById('bestLbl');
const btnPause = document.getElementById('btnPause');
const btnRestart = document.getElementById('btnRestart');
const btnCloseSnake = document.getElementById('btnCloseSnake');

const GRID = 16;
const N = 20; // –ø–æ–ª–µ N x N (320x320)

let snake, dir, food, loop, speed, score, best, paused=false;

function rndCell(){ return {x:Math.floor(Math.random()*N), y:Math.floor(Math.random()*N)}; }

function resetGame(){
  snake=[{x:10,y:10},{x:9,y:10},{x:8,y:10}];
  dir={x:1,y:0};
  food=rndCell();
  speed=110; score=0; paused=false;
  best = parseInt(localStorage.getItem('snake_best')||'0',10);
  scoreLbl.textContent='–û—á–∫–∏: '+score;
  bestLbl.textContent='–†–µ–∫–æ—Ä–¥: '+best;
}
function drawCell(x,y,color){ ctx.fillStyle=color; ctx.fillRect(x*GRID,y*GRID,GRID-1,GRID-1); }

function step(){
  if(paused) return;
  const head={x:(snake[0].x+dir.x+N)%N, y:(snake[0].y+dir.y+N)%N};
  if (snake.some((s,i)=>i>0 && s.x===head.x && s.y===head.y)){
    resetGame();
  } else {
    snake.unshift(head);
    if (head.x===food.x && head.y===food.y){
      score++; scoreLbl.textContent='–û—á–∫–∏: '+score;
      if(score>best){ best=score; localStorage.setItem('snake_best', String(best)); bestLbl.textContent='–†–µ–∫–æ—Ä–¥: '+best; }
      food=rndCell(); if (speed>60) speed-=3;
    } else snake.pop();
  }

  ctx.clearRect(0,0,can.width,can.height);
  ctx.strokeStyle='rgba(255,255,255,.05)';
  for(let i=0;i<=N;i++){ ctx.beginPath(); ctx.moveTo(i*GRID,0); ctx.lineTo(i*GRID,N*GRID); ctx.stroke(); }
  for(let i=0;i<=N;i++){ ctx.beginPath(); ctx.moveTo(0,i*GRID); ctx.lineTo(N*GRID,i*GRID); ctx.stroke(); }
  drawCell(food.x, food.y, '#22c55e');
  snake.forEach((s,i)=> drawCell(s.x,s.y, i===0?'#60a5fa':'#94a3b8'));

  clearTimeout(loop);
  loop=setTimeout(step, speed);
}
function start(){ resetGame(); step(); }

function setDir(nx,ny){
  if (snake.length>1 && (snake[0].x+nx===snake[1].x) && (snake[0].y+ny===snake[1].y)) return;
  dir={x:nx,y:ny};
}

/* –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ */
window.addEventListener('keydown', e=>{
  if (!snakeDialog.open) return;
  const k=e.key.toLowerCase();
  if(k==='arrowup'||k==='w') setDir(0,-1);
  else if(k==='arrowdown'||k==='s') setDir(0,1);
  else if(k==='arrowleft'||k==='a') setDir(-1,0);
  else if(k==='arrowright'||k==='d') setDir(1,0);
  else if(k===' '){ paused=!paused; if(!paused) step(); }
});

/* –º–∏—à–∫–∞/—Ç–∞–ø */
function turnByPoint(px, py){
  const rect = can.getBoundingClientRect();
  const x = px - rect.left, y = py - rect.top;
  const headX = (snake[0].x + 0.5) * GRID * (rect.width / (N*GRID));
  const headY = (snake[0].y + 0.5) * GRID * (rect.height / (N*GRID));
  const dx = x - headX, dy = y - headY;
  if (Math.abs(dx) > Math.abs(dy)) setDir(dx > 0 ? 1 : -1, 0);
  else                             setDir(0, dy > 0 ? 1 : -1);
}
can.addEventListener('touchmove', e => e.preventDefault(), { passive:false });
can.addEventListener('touchstart', e => {
  const t = e.changedTouches[0];
  turnByPoint(t.clientX, t.clientY);
  e.preventDefault();
}, { passive:false });
can.addEventListener('mousedown', e => { turnByPoint(e.clientX, e.clientY); });

/* –≤—ñ–¥–∫—Ä–∏—Ç–∏/–∑–∞–∫—Ä–∏—Ç–∏ */
function openSnake(){
  document.body.style.overflow='hidden';
  snakeDialog.showModal();
  start();
}
function closeSnake(){
  snakeDialog.close();
  document.body.style.overflow='';
  paused=true;
  clearTimeout(loop);
}

openSnakeBtn.addEventListener('click', openSnake);
btnCloseSnake.addEventListener('click', closeSnake);
btnPause.addEventListener('click', ()=>{ paused=!paused; if(!paused) step(); });
btnRestart.addEventListener('click', ()=> start() );
</script>

</body>
</html>