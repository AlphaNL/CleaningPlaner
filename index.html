<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Clean Planner</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#4f82ff">
  <link rel="apple-touch-icon" href="assets/icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Мій розклад</h1>
    <button id="addClientBtn">+ Клієнт</button>
    <button id="refreshBtn" class="ghost">Оновити</button>
  </header>

  <main>
    <section class="card">
      <h2>План на завтра</h2>
      <ul id="tomorrowList" class="list"></ul>
      <div id="tomorrowEmpty" class="muted">Немає запланованих прибирань на завтра</div>
    </section>

    <section class="card">
      <h2>Клієнти</h2>
      <div class="toolbar">
        <input id="search" placeholder="Пошук по імені/вулиці/адресі/телефону" />
      </div>
      <ul id="clientsList" class="list"></ul>
    </section>

    <!-- КНОПКА ВІДКРИТИ ГРУ -->
    <section class="card">
      <h2>Змійка</h2>
      <p class="muted">Натисни «Грати», щоб відкрити гру на весь екран.</p>
      <button class="btn" id="openSnake">Грати</button>
    </section>
  </main>

  <!-- ДІАЛОГ ДОДАТИ/РЕДАГУВАТИ -->
  <dialog id="clientDialog">
    <form id="clientForm">
      <h3 id="dialogTitle">Новий клієнт</h3>
      <input type="hidden" id="clientId">
      <label>Ім’я <input id="name" required></label>
      <label>Вулиця <input id="street"></label>
      <label>Адреса <input id="address"></label>
      <label>Телефон <input id="phone" type="tel" placeholder="+31 6 12 34 56 78"></label>
      <label>Нотатки <textarea id="notes" rows="3"></textarea></label>

      <fieldset>
        <legend>Розклад</legend>
        <label>День тижня
          <select id="weekday">
            <option value="2">Пн</option><option value="3">Вт</option><option value="4">Ср</option>
            <option value="5">Чт</option><option value="6">Пт</option><option value="7">Сб</option><option value="1">Нд</option>
          </select>
        </label>
        <label>Повторення
          <select id="frequency">
            <option value="1">Щотижня</option>
            <option value="2">Раз на 2 тижні</option>
          </select>
        </label>
      </fieldset>

      <fieldset>
        <legend>Нагадування</legend>
        <label>Час <input id="remTime" type="time" value="09:00"></label>
        <label>За скільки хв нагадати <input id="remOffset" type="number" value="0" min="0" max="240" step="5"></label>
      </fieldset>

      <menu>
        <button type="button" id="cancelBtn">Скасувати</button>
        <button id="saveBtn" type="submit">Зберегти</button>
      </menu>
    </form>
  </dialog>

  <!-- ДІАЛОГ ПЕРЕГЛЯДУ -->
  <dialog id="clientViewDialog">
    <div class="view-card">
      <h3 id="vName"></h3>
      <div class="v-row"><span class="v-label">Адреса:</span> <span id="vAddress"></span></div>
      <div class="v-row"><span class="v-label">Вулиця:</span> <span id="vStreet"></span></div>
      <div class="v-row"><span class="v-label">Телефон:</span> <a id="vPhone" href="#" class="link"></a></div>
      <div class="v-row"><span class="v-label">Нотатки:</span></div>
      <div id="vNotes" class="v-notes"></div>
      <menu><button id="vClose">Закрити</button></menu>
    </div>
  </dialog>

  <!-- ПОВНОЕКРАННА ЗМІЙКА -->
  <dialog id="snakeDialog" class="snake-full">
    <div class="snake-topbar">
      <div class="snake-scores">
        <span id="scoreLbl">Очки: 0</span>
        <span id="bestLbl">Рекорд: 0</span>
      </div>
      <div class="snake-actions">
        <button class="btn" id="btnPause">Пауза</button>
        <button class="btn" id="btnRestart">Спочатку</button>
        <button class="btn danger" id="btnCloseSnake">Закрити</button>
      </div>
    </div>
    <div class="snake-wrap">
      <canvas id="snakeCanvas" width="320" height="320"></canvas>
    </div>
    <div class="game-hint">Тицяй на сторону поля, щоб повертати змійку. Клавіатура: стрілки/WASD.</div>
  </dialog>

  <script src="app.js"></script>

  <!-- Кнопка Оновити -->
  <script>
  document.getElementById('refreshBtn')?.addEventListener('click', async () => {
    try {
      if ('caches' in window) {
        const keys = await caches.keys();
        await Promise.all(keys.map(k => caches.delete(k)));
      }
      if ('serviceWorker' in navigator) {
        const regs = await navigator.serviceWorker.getRegistrations();
        await Promise.all(regs.map(r => r.unregister()));
      }
    } catch(e) { console.warn(e); }
    location.reload();
  });
  </script>
</body>
</html>
