<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clean Planner — Snake Game</title>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: ui-sans-serif, sans-serif;
  }
  body {
    background: #f2f4ff;
    color: #0f172a;
  }
  .card {
    max-width: 600px;
    margin: 20px auto;
    background: white;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  h2 {
    font-size: 20px;
    margin-bottom: 12px;
  }
  .banner {
    position: relative;
    cursor: pointer;
  }
  .banner img {
    width: 100%;
    border-radius: 10px;
  }
  .snake-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: #111827;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .modal-header {
    position: absolute;
    top: 16px;
    left: 16px;
  }
  .modal-header button {
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    background: #ff3b3b;
    color: white;
    font-size: 14px;
    cursor: pointer;
  }
  #snakeCanvas {
    background: #0b1220;
    touch-action: none;
  }
</style>
</head>
<body>

<main class="card">
  <h2>Гра "Змійка"</h2>
  <div class="banner" id="banner">
    <img src="https://raw.githubusercontent.com/AlphaNL/CleaningPlaner/5d9c580ae8f440fa242188981eec72cc2a536806/FC0A03B0-579F-4F9D-8C47-801A1D3D0698.png" alt="Snake Banner">
  </div>
</main>

<dialog class="snake-modal" id="snakeModal">
  <div class="modal-header">
    <button id="closeSnake">Назад</button>
  </div>
  <canvas id="snakeCanvas" width="320" height="320"></canvas>
</dialog>

<script>
  const banner = document.getElementById('banner');
  const modal = document.getElementById('snakeModal');
  const closeBtn = document.getElementById('closeSnake');
  const canvas = document.getElementById('snakeCanvas');
  const ctx = canvas.getContext('2d');
  const grid = 16, size = 320;
  let snake, dir, food, gameLoop;

  function startSnake() {
    snake = [{x:8*grid, y:8*grid}];
    dir = {x:1, y:0};
    food = randCell();
    modal.showModal();
    gameLoop = setInterval(step, 120);
  }

  function randCell(){
    return {
      x: Math.floor(Math.random()*20)*grid,
      y: Math.floor(Math.random()*20)*grid
    };
  }

  function step(){
    ctx.fillStyle = '#0b1220';
    ctx.fillRect(0,0,size,size);

    // малюємо змійку
    for(let i=0;i<snake.length;i++){
      ctx.fillStyle = i===0? '#60a5fa':'#94a3b8';
      ctx.fillRect(snake[i].x, snake[i].y, grid-1, grid-1);
    }

    // малюємо їжу
    ctx.fillStyle = '#22c55e';
    ctx.fillRect(food.x, food.y, grid-1, grid-1);

    const head = {...snake[0]};
    head.x += dir.x*grid;
    head.y += dir.y*grid;

    // перевірка на програш
    if(
      head.x<0 || head.x>=size ||
      head.y<0 || head.y>=size ||
      snake.some((s,i)=>i>0 && s.x===head.x && s.y===head.y)
    ){
      clearInterval(gameLoop);
      modal.close();
      return;
    }

    snake.unshift(head);

    if(head.x===food.x && head.y===food.y) {
      food = randCell();
    } else {
      snake.pop();
    }
  }

  function setDirTowards(x,y){
    const head = snake[0];
    const dx = x - head.x;
    const dy = y - head.y;
    if(Math.abs(dx) > Math.abs(dy))
      dir = {x: dx>0?1:-1, y:0};
    else
      dir = {x:0, y: dy>0?1:-1};
  }

  // керування по кліку
  canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    setDirTowards(
      Math.floor((e.clientX-rect.left)/grid)*grid,
      Math.floor((e.clientY-rect.top)/grid)*grid
    );
  });

  // керування по тапу
  canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    const t = e.changedTouches[0];
    const rect = canvas.getBoundingClientRect();
    setDirTowards(
      Math.floor((t.clientX-rect.left)/grid)*grid,
      Math.floor((t.clientY-rect.top)/grid)*grid
    );
  }, {passive:false});

  banner.onclick = startSnake;
  closeBtn.onclick = ()=>{
    clearInterval(gameLoop);
    modal.close();
  };
</script>

</body>
</html>
